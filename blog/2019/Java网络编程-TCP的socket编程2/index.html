<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Java网络编程：TCP的socket编程2 | Tianchi YU</title> <meta name="author" content="Tianchi YU"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://lialittis.github.io/blog/2019/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-TCP%E7%9A%84socket%E7%BC%96%E7%A8%8B2/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Tianchi </span>YU</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">GitRepos</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Java网络编程：TCP的socket编程2</h1> <p class="post-meta">October 29, 2019• TC YU</p> <p class="post-tags"> <a href="/blog/2019"> <i class="fas fa-calendar fa-sm"></i> 2019 </a>   ·   <a href="/blog/tag/java"> <i class="fas fa-hashtag fa-sm"></i> Java</a>   <a href="/blog/tag/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C"> <i class="fas fa-hashtag fa-sm"></i> 计算机网络</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="java网络编程">Java网络编程</h1> <h2 id="enchanges-de-messages-élémentaires-avec-tcp">Enchanges de messages élémentaires avec TCP</h2> <p>Quand deux applications Java sont connectées avec TCP, chacune d’elle contient une instance de la classe java.net.Socket initialisée pour communiquer avec l’autre application.</p> <p>L’envoi et la réception de messages se font à travers deux attributs de cette socket :</p> <p>l’attribut privé outputStream de type java.io.OutputStream permet d’envoyer des octets (flot de sortie : les données sortent du programme par la socket) l’attribut privé inputStream de type java.io.InputStream permet de recevoir des octets (flot d’entrée : les données entrent dans le programme par la socket)</p> <p>[picure:java_output_input]</p> <h3 id="réalisation-dun-premier-protocole">Réalisation d’un premier protocole</h3> <h2 id="echanges-de-messages-texte-avec-tcp">Echanges de messages texte avec TCP</h2> <h3 id="envoi-et-réception-de-chaines-de-caractères-avec-tcp">Envoi et réception de chaines de caractères avec TCP</h3> <p>Les flots d’entrée et de sortie d’une socket TCP permettent de recevoir et d’envoyer des octets vers une autre application Java. Pour envoyer et recevoir des chaines de caractères, il faut introduire trois classes supplémentaires :</p> <p>la classe java.io.PrintWriter pour envoyer des chaines de caractères via le flot de sortie d’une socket la classe java.io.BufferedReader pour recevoir des chaines de caractères via le flot d’entrée d’une socket, par l’intermédiaire d’une instance de java.io.InputStreamReader.</p> <h3 id="réception-de-chaines-de-caractères-avec-tcp">Réception de chaines de caractères avec TCP</h3> <h3 id="communication-client-serveur">communication client-serveur</h3> <p>Objectifs de l’activité Savoir expliquer avec ses propres mots les notions de client, serveur, requête, réponse, boucle de service. Relier ces notions à la programmation d’applications Java connectées par TCP</p> <h3 id="principe-général">Principe général</h3> <p>Une application client-serveur est une application répartie entre plusieurs processus communicants : un processus serveur et un ou plusieurs processus clients. Le processus serveur offre une boucle de service, où l’interaction suivante est répétée :</p> <p>un client envoie un message de requête au serveur et se bloque en attente de réponse, le serveur traite la requête, le serveur envoie un message de réponse au client d’origine, le client est débloqué et traite la réponse.</p> <p>[picture:java_client_server.jpg]</p> <h3 id="protocole-de-communication-client-serveur">Protocole de communication client-serveur</h3> <p>La communication client-serveur doit respecter un protocole bien défini :</p> <p>Le serveur doit être lancé avant les clients. À chaque requête, le serveur doit envoyer une réponse. Les messages de requête doivent avoir un format clairement défini. Il peut y avoir plusieurs types de requêtes, avec pour chaque type de requête des paramètres différents (nombre, types et valeurs de paramètres). Les messages de réponse doivent avoir une format clairement défini. Il peut y avoir plusieurs types de réponses, avec pour chaque type de réponse des valeurs différentes. Les messages de réponse doivent couvrir les cas d’erreur : format de requête invalide, ou erreur interne du serveur. Comme dans le cas des exceptions Java, ces messages d’erreur doivent être informatifs.</p> <h3 id="programmer-un-protocole-de-communication-client-serveur-en-java">Programmer un protocole de communication client-serveur en Java</h3> <h3 id="boucle-de-service-tcp-mono-client">Boucle de service TCP mono-client</h3> <p><strong>Un seul type de requête en mode texte</strong> Dans un premier temps, on considère un serveur qui reçoit un seul type de requête, en mode texte.</p> <p>Le protocole(Serveur Echo pour un client unique) est très simple :</p> <ul> <li>la requête est constituée d’une chaine de caractères, vide ou non</li> <li>la réponse est constituée de la chaine reçue dans la requête</li> <li>la boucle de service s’arrête quand le client se déconnecte, ce qui provoque un retour de null dans le readLine() qui attend une requête du client</li> </ul> <p>[picture:java_boucle_mini.jpg]</p> <p><strong>Plusieurs types de requêtes en mode texte</strong></p> <p>Un serveur peut recevoir plusieurs types de requêtes, dans un ordre inconnu à l’avance. Il faut alors écrire une boucle de service où chaque requête est analysée puis traitée avec une méthode spécifique.</p> <p>On considère un serveur qui reçoit plusieurs types de requête. Il faut alors :</p> <p>Différencier les requêtes Détecter les requêtes invalides Traiter chaque cas avant de renvoyer un message de réponse au client.</p> <p>对于不同的客户请求进行不同的处理，在这里我采用的方式是在server的方法中采用了<code class="language-plaintext highlighter-rouge">switch(){case}</code>的方法。</p> <p><strong>Extraire des types primitifs d’une requête texte</strong></p> <p>在本示例中，需要学会使用Integer和Double两个类中的几个方法，例如parseInt(String,int)和parseDouble(String,int)，同时对repeat的请求在服务器中提供for循环语句。 另外，由于parseInt和parseDouble的使用条件比较严格，可能会throw出异常，因此无法直接赋值，需要用到<code class="language-plaintext highlighter-rouge">try{}catch(Exception e){}</code>的方法进行弥补。</p> <hr> <p><strong><em>小知识点：</em></strong> &amp;和&amp;&amp;在java中的不同————都是与操作，但是无论什么情况，&amp;操作中，前后两个语句都会被执行，但是&amp;&amp;操作要求，只有在前一个语句是true的情况下，才会执行后一个语句，因此可以认为&amp;&amp;提高了代码的执行效率。 <strong>**</strong>***</p> <h3 id="boucle-de-service-tcp-pour-clients-sérialisés">Boucle de service TCP pour clients sérialisés</h3> <p>本练习在于建立多个clients与服务器进行沟通。首先需要做到的一件事情是，保证服务器持续接受请求，只能手动切断；其次，为了保证可以分段接收不同客户的请求，需要在原本单一请求外建立更大的循环用于更新用户，而原本内部循环用于处理单一用户的多个信息和断连。为了实现这个目的，我们加入了一个新的类————Service————用于在server服务器类中调用的可以用之来建立实例处理单一用户的请求的类，这样简化了服务器类的代码量，同时方便处理不同用户的请求。</p> <p>进一步考虑用户请求，除了全部处理完成外，如果用户提出某一特殊请求，其功能是提前结束服务器对其的连接和请求处理，即意味着服务器拒绝此后的所有用户请求，并且关闭自身的循环（停止悬挂）。对于这样的功能，我的方法是在service单循环中提供新的终止连接条件并建立返回值，通过返回值判断处理用户请求的情况的正常与否（特殊请求为不正常情况，而其他请求或者完成处理都为正常情况），并进一步指导server服务器类的停止悬挂或者正常循环。</p> <hr> <p><strong><em>小知识点：</em></strong> 比较两String的值，需要用.equals()函数，而不是 == 。 <strong>**</strong>***</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/displaying-external-posts-on-your-al-folio-blog/">Displaying External Posts on Your al-folio Blog</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/Signature-Algorithm/">Signature Algorithm 数字签名算法</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/CS423-Distributed-Information-Systems/">CS423 Distributed Information Systems</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/DIS-Classification/">DIS - Classification</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/Software-Security-1-(Basic-Principles)/">Software Security 1 (Basic Principles)</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Tianchi YU. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js"></script> <script defer src="/assets/js/common.js"></script> <script defer src="/assets/js/copy_code.js" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>